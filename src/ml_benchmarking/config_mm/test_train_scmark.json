{
  "mode": "train",

  "wandb_project_name": "mm_scmark",

  "run_save_dir": "../mm_runs/test_scmark/",

  "datamodule": {
    "class_name": "TileDBSomaIterDataModule",
    "options": {
      "soma_experiment_uri": "s3://pai-scrnaseq/sctx_gui/corpora/scmark/",
      "genes_to_use_path": "../data/gene_lists/genes_2ksamples_10cells.txt",
      "block_size": 5000,
      "random_seed": 1,
      "dataloader_args": {
        "batch_size": 256,
        "num_workers": 4,
        "pin_memory": true
      },
      "batch_keys": {
        "modality": "scrnaseq_protocol",
        "study": "study_name",
        "sample": "sample_name"
      }
    }
  },
  "emb_trainer": {
    "model_args": {
    
      "n_latent": 10,
      "n_cell_type_experts": 10
    },
    
    "training_args": {
      "train_library": true,

      "reconstruction_loss_weight": 5000.0,
      "kl_loss_weight": 1.0,
      "modality_class_weight": 10.0,
      "celltype_class_weight": 10.0,
      "deconv_weight": 1000.0,
      "diversity_weight": 1000.0,

      "save_validation_umaps": true,
      "run_validation_metrics": false,

      "g_optimizer": {
        "lr": 1e-4,
        "weight_decay": 1e-5
      },
      "d_optimizer": {
        "lr": 1e-4,
        "weight_decay": 1e-5
      },

      "train_adversarial": true
    },
    "callbacks_args": {
      "model_checkpoint": {
        "monitor": "val_loss/loss",
        "mode": "min"
      },
      "early_stopping": {
        "monitor": "val_loss/loss",
        "patience": 5,
        "mode": "min"
      }
    }
  },
  "pl_trainer": {
    "check_val_every_n_epoch": 1
  }
}
