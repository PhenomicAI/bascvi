{
  "mode": "train",

  "wandb_project_name": "mm_25Feb2025_big",

  "run_save_dir": "../mm_runs/multimode_25Feb2025_big/",

  "datamodule": {
    "class_name": "TileDBSomaIterDataModule",
    "options": {
      "soma_experiment_uri": "../data/corpora/multimode_25Feb2025/",
      "barcodes_to_use_path": "../data/barcode_lists/multimode_25Feb2025_train_barcodes_big.pkl",
      "genes_to_use_path": "../data/gene_lists/genes_2ksamples_10cells.txt",
      "block_size": 81920,
      "random_seed": 1,
      "dataloader_args": {
        "batch_size": 256,
        "num_workers": 1,
        "pin_memory": true
      },
      "batch_keys": {
        "modality": "scrnaseq_protocol",
        "study": "study_name",
        "sample": "sample_name"
      },
      "dataset_args": {
        "max_queue_size": 300000,
        "prefetch_threads_per_worker": 4
      }
    }
  },
  "emb_trainer": {
    "model_args": {
      "latent_dim": 16,
      "ct_latent_dim": 16,
      "n_cell_type_experts": 16,
      "modality_encoder_hidden_dims": [512, 256],
      "ct_encoder_hidden_dims": [512, 256, 128],
      "predictor_hidden_dims": [128, 64],
      "decoder_hidden_dims": [128, 256, 512],
      "residual_weight": 0.0
    },
    
    "training_args": {
      "train_library": true,

      "loss_weights": {
        "reconstruction": 1000.0,
        "bulk_reconstruction": 0.01,
        "kl": 0.1,
        "ct_discriminator": [50.0, 1.0, 1.0],
        "z_discriminator": [50.0, 1.0, 1.0],
        "ct_diversity": 0.0,
        "ct_regularization": 100.0,
        "adversarial": 0.01
      },

      "desired_ct_rank": 2,

      "n_steps_kl_ramp ": 40000,
      "n_steps_adv_ramp": 40000,
      "n_steps_adv_start": 40000,


      "save_validation_embeddings": false,
      "save_validation_umaps": true,
      "downsample_umaps_to_n_cells": 75000,
      "run_validation_metrics": false,

      "g_optimizer": {
        "lr": 1e-3,
        "weight_decay": 1e-5
      },
      "d_optimizer": {
        "lr": 5e-4,
        "weight_decay": 1e-5
      },

      "train_adversarial": true
    },
    "callbacks_args": {
      "model_checkpoint": {
        "monitor": "val/g/loss",
        "mode": "min"
      },
      "early_stopping": {
        "monitor": "val/g/loss",
        "patience": 5,
        "mode": "min"
      }
    }
  },
  "pl_trainer": {
    "check_val_every_n_epoch": 1
  }
}
