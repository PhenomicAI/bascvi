{
  "mode": "train",

  "wandb_project_name": "mm_25Feb2025_med",

  "run_save_dir": "../mm_runs/multimode_25Feb2025_med/",

  "datamodule": {
    "class_name": "TileDBSomaIterDataModule",
    "options": {
      "soma_experiment_uri": "../data/corpora/multimode_25Feb2025/",
      "barcodes_to_use_path": "../data/barcode_lists/multimode_25Feb2025_train_barcodes_med.pkl",
      "genes_to_use_path": "../data/gene_lists/genes_2ksamples_10cells.txt",
      "block_size": 128000,
      "random_seed": 1,
      "dataloader_args": {
        "batch_size": 256,
        "num_workers": 1,
        "pin_memory": true
      },
      "batch_keys": {
        "modality": "scrnaseq_protocol",
        "study": "study_name",
        "sample": "sample_name"
      }
    }
  },
  "emb_trainer": {
    "model_args": {
      "n_latent": 16,
      "n_cell_type_experts": 4,
      "encoder_hidden_dims": [256, 256],
      "predictor_hidden_dims": [256, 256],
      "decoder_hidden_dims": [256, 256],
      "residual_weight": 0.0
    },
    
    "training_args": {
      "train_library": true,

      "reconstruction_loss_weight": 1000.0,
      "kl_loss_weight": 1.0,

      "modality_class_weight": 0.0,

      "batch_discriminator_ct_weight": 10.0,
      "batch_discriminator_final_weight": 1.0,

      "discriminator_batch_level_weights": [10.0, 1.0, 1.0],

      "diversity_weight": 1000.0,

      "save_validation_embeddings": true,
      "save_validation_umaps": true,
      "run_validation_metrics": false,

      "g_optimizer": {
        "lr": 1e-4,
        "weight_decay": 1e-5
      },
      "d_optimizer": {
        "lr": 1e-4,
        "weight_decay": 1e-5
      },

      "train_adversarial": true
    },
    "callbacks_args": {
      "model_checkpoint": {
        "monitor": "val_loss/loss",
        "mode": "min"
      },
      "early_stopping": {
        "monitor": "val_loss/loss",
        "patience": 5,
        "mode": "min"
      }
    }
  },
  "pl_trainer": {
    "check_val_every_n_epoch": 2
  }
}
